{% comment %}
  Cart Whisper AI - Smart Product Recommendations
  This block displays AI-powered product recommendations in the cart
{% endcomment %}

<div id="cart-whisper-recommendations"
     class="cart-whisper-container"
     data-shop="{{ shop.permanent_domain }}"
     style="display: none;">

  <div class="cart-whisper-header">
    <h3 class="cart-whisper-title">{{ block.settings.title }}</h3>
    {% if block.settings.subtitle != blank %}
      <p class="cart-whisper-subtitle">{{ block.settings.subtitle }}</p>
    {% endif %}
  </div>

  <div class="cart-whisper-products" id="cart-whisper-products-list">
    <!-- Products will be loaded dynamically -->
  </div>

  <div class="cart-whisper-loading" id="cart-whisper-loading">
    <div class="cart-whisper-spinner"></div>
    <span>{{ block.settings.loading_text }}</span>
  </div>

  <!-- Watermark (shown for free users) -->
  <div id="cart-whisper-rec-watermark" class="cart-whisper-rec-watermark" style="display: none;">
    <span>ü§ñ Powered by <a href="https://cartwhisper.ai" target="_blank" rel="noopener">CartWhisper AI</a></span>
  </div>

</div>

<style>
  .cart-whisper-container {
    margin: {{ block.settings.margin_top }}px 0 {{ block.settings.margin_bottom }}px;
    padding: 20px;
    background: {{ block.settings.background_color }};
    border-radius: {{ block.settings.border_radius }}px;
    {% if block.settings.show_border %}
    border: 1px solid {{ block.settings.border_color }};
    {% endif %}
  }

  .cart-whisper-header {
    margin-bottom: 16px;
    text-align: {{ block.settings.text_align }};
  }

  .cart-whisper-title {
    font-size: {{ block.settings.title_size }}px;
    font-weight: 600;
    color: {{ block.settings.title_color }};
    margin: 0 0 8px 0;
  }

  .cart-whisper-subtitle {
    font-size: 14px;
    color: {{ block.settings.subtitle_color }};
    margin: 0;
  }

  .cart-whisper-products {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax({{ block.settings.card_min_width }}px, 1fr));
    gap: 16px;
  }

  .cart-whisper-product {
    background: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.2s, box-shadow 0.2s;
    display: flex;
    flex-direction: column;
  }

  .cart-whisper-product:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
  }

  .cart-whisper-product-image {
    width: 100%;
    aspect-ratio: 1;
    object-fit: cover;
    background: #f5f5f5;
  }

  .cart-whisper-product-info {
    padding: 12px;
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .cart-whisper-product-title {
    font-size: 14px;
    font-weight: 500;
    color: #333;
    margin: 0 0 8px;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .cart-whisper-product-reasoning {
    font-size: 12px;
    color: #666;
    margin: 0 0 12px;
    line-height: 1.5;
    flex: 1;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .cart-whisper-product-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: auto;
  }

  .cart-whisper-product-price {
    font-size: 16px;
    font-weight: 600;
    color: {{ block.settings.price_color }};
  }

  .cart-whisper-add-btn {
    background: {{ block.settings.button_color }};
    color: {{ block.settings.button_text_color }};
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: opacity 0.2s;
  }

  .cart-whisper-add-btn:hover {
    opacity: 0.9;
  }

  .cart-whisper-add-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .cart-whisper-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 40px;
    color: #666;
  }

  .cart-whisper-spinner {
    width: 24px;
    height: 24px;
    border: 2px solid #e0e0e0;
    border-top-color: {{ block.settings.button_color }};
    border-radius: 50%;
    animation: cart-whisper-spin 1s linear infinite;
  }

  @keyframes cart-whisper-spin {
    to { transform: rotate(360deg); }
  }

  .cart-whisper-no-recommendations {
    text-align: center;
    padding: 20px;
    color: #666;
  }

  .cart-whisper-rec-watermark {
    padding: 12px 0 0 0;
    text-align: center;
    font-size: 11px;
    color: #999;
    border-top: 1px solid #f0f0f0;
    margin-top: 20px;
  }

  .cart-whisper-rec-watermark a {
    color: #007bff;
    text-decoration: none;
    font-weight: 500;
  }

  .cart-whisper-rec-watermark a:hover {
    text-decoration: underline;
  }

  @media (max-width: 768px) {
    .cart-whisper-products {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 480px) {
    .cart-whisper-products {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
(function() {
  'use strict';

  const container = document.getElementById('cart-whisper-recommendations');
  if (!container) return;

  const shop = container.dataset.shop;
  const limit = 6; // ËØ∑Ê±ÇÊúÄÂ§ßÊï∞ÈáèÔºåÂêéÁ´Ø‰ºöÊ†πÊçÆËÆ¢ÈòÖËÆ°ÂàíÈôêÂà∂ÂÆûÈôÖËøîÂõûÊï∞Èáè
  const productsList = document.getElementById('cart-whisper-products-list');
  const loadingEl = document.getElementById('cart-whisper-loading');

  // Ëé∑ÂèñË¥≠Áâ©ËΩ¶‰∏≠ÁöÑÂïÜÂìÅ
  async function getCartItems() {
    try {
      const response = await fetch('/cart.js');
      const cart = await response.json();
      return cart.items || [];
    } catch (error) {
      console.error('CartWhisper: Failed to get cart items', error);
      return [];
    }
  }

  // Shopify App API URLÔºàÊé®ËçêÊé•Âè£Ôºâ
  const appUrl = 'https://cartwhisperai-production.up.railway.app';

  // Railway ÂêéÁ´Ø API URLÔºà‰ªÖÁî®‰∫éËøΩË∏™Ôºâ
  const backendUrl = 'https://cartwhisperaibackend-production.up.railway.app';

  // ÂΩìÂâçÊ∫êÂïÜÂìÅ IDÔºàÁî®‰∫éËøΩË∏™Ôºâ
  let currentSourceProductId = null;

  // ÁºìÂ≠òÈÖçÁΩÆ
  const CACHE_KEY_PREFIX = 'cw_rec_';
  const CACHE_TTL = 30 * 60 * 1000; // 30 ÂàÜÈíüÁºìÂ≠ò
  const PLAN_CACHE_KEY = 'cw_plan_limit'; // Â≠òÂÇ®ÂΩìÂâçplanÁöÑÊé®ËçêÈôêÂà∂

  // ‰ªéÁºìÂ≠òËé∑ÂèñÊé®ËçêÔºàÂÆåÊï¥ÂàóË°®Ôºå‰∏çÈôêÂà∂Êï∞ÈáèÔºâ
  function getCachedRecommendations(productId) {
    try {
      const key = CACHE_KEY_PREFIX + productId;
      const cached = localStorage.getItem(key);
      if (!cached) return null;

      const { data, timestamp } = JSON.parse(cached);
      // Ê£ÄÊü•ÊòØÂê¶ËøáÊúü
      if (Date.now() - timestamp > CACHE_TTL) {
        localStorage.removeItem(key);
        return null;
      }

      console.log('[CartWhisper] Cache hit for product:', productId, '- got', data.length, 'recommendations');
      return data;
    } catch (e) {
      return null;
    }
  }

  // ‰øùÂ≠òÊé®ËçêÂà∞ÁºìÂ≠òÔºàÂ≠òÂÇ®ÂÆåÊï¥ÂàóË°®Ôºâ
  function cacheRecommendations(productId, recommendations) {
    try {
      const key = CACHE_KEY_PREFIX + productId;
      localStorage.setItem(key, JSON.stringify({
        data: recommendations,
        timestamp: Date.now()
      }));
      console.log('[CartWhisper] Cached', recommendations.length, 'recommendations for product:', productId);
    } catch (e) {
      // localStorage ÂèØËÉΩÂ∑≤Êª°ÔºåÊ∏ÖÁêÜÊóßÁºìÂ≠ò
      clearOldCache();
    }
  }

  // Ê∏ÖÁêÜËøáÊúüÁºìÂ≠ò
  function clearOldCache() {
    try {
      const keys = Object.keys(localStorage).filter(k => k.startsWith(CACHE_KEY_PREFIX));
      keys.forEach(key => {
        try {
          const { timestamp } = JSON.parse(localStorage.getItem(key));
          if (Date.now() - timestamp > CACHE_TTL) {
            localStorage.removeItem(key);
          }
        } catch (e) {
          localStorage.removeItem(key);
        }
      });
    } catch (e) {}
  }

  // Ê†áËÆ∞ÊòØÂê¶‰ªéÁºìÂ≠òÂä†ËΩΩÔºàÁî®‰∫éÂÜ≥ÂÆöÊòØÂê¶ËøΩË∏™Â±ïÁ§∫Ôºâ
  let loadedFromCache = false;

  // ‰ªéAPIËé∑ÂèñÊé®ËçêÔºåÊØèÊ¨°ÈÉΩÂÖàËé∑ÂèñÊúÄÊñ∞ÁöÑËÆ¢ÈòÖÁ∫ßÂà´
  async function fetchRecommendations(productId) {
    currentSourceProductId = productId;
    loadedFromCache = false;

    // üî• Ë∞ÉÁî® Shopify Â∫îÁî®ÁöÑ APIÔºàÊúâÊ≠£Á°ÆÁöÑËÆ¢ÈòÖÊ£ÄÊü•ÈÄªËæëÔºâ
    const fetchUrl = `${appUrl}/api/recommendations/${encodeURIComponent(shop)}/${productId}?limit=${limit}`;
    console.log('[CartWhisper] Fetching recommendations from Shopify App:', fetchUrl);

    try {
      const response = await fetch(fetchUrl);
      console.log('[CartWhisper] Response status:', response.status);

      if (!response.ok) {
        const text = await response.text();
        console.error('[CartWhisper] Error response:', text);
        throw new Error('API request failed');
      }

      const data = await response.json();
      const apiRecommendations = data.recommendations || [];
      const maxRecommendations = data.maxRecommendations || 1;
      const showWatermark = data.showWatermark !== false;

      console.log(`[CartWhisper] API returned: ${apiRecommendations.length} recommendations, maxRecommendations: ${maxRecommendations}, showWatermark: ${showWatermark}`);

      // üî• Ê£ÄÊü•planÊòØÂê¶ÂèòÂåñÔºåÂ¶ÇÊûúÂèòÂåñÂàôÊ∏ÖÈô§ÊâÄÊúâÊé®ËçêÁºìÂ≠ò
      const cachedPlanLimit = localStorage.getItem(PLAN_CACHE_KEY);
      if (cachedPlanLimit && parseInt(cachedPlanLimit) !== maxRecommendations) {
        console.log(`[CartWhisper] Plan changed from ${cachedPlanLimit} to ${maxRecommendations}, clearing all caches`);
        const keys = Object.keys(localStorage).filter(k => k.startsWith(CACHE_KEY_PREFIX));
        keys.forEach(key => localStorage.removeItem(key));
      }
      // Êõ¥Êñ∞planÈôêÂà∂ÁºìÂ≠ò
      localStorage.setItem(PLAN_CACHE_KEY, maxRecommendations.toString());

      // ÊòæÁ§∫/ÈöêËóèÊ∞¥Âç∞ÔºàÊ†πÊçÆÊúÄÊñ∞ÁöÑËÆ¢ÈòÖÁä∂ÊÄÅÔºâ
      const watermarkEl = document.getElementById('cart-whisper-rec-watermark');
      if (watermarkEl) {
        watermarkEl.style.display = showWatermark ? 'block' : 'none';
      }

      // üî• Ê£ÄÊü•ÁºìÂ≠òÔºàÂú®Ëé∑ÂèñËÆ¢ÈòÖÁ∫ßÂà´‰πãÂêéÔºâ
      const cached = getCachedRecommendations(productId);
      let recommendations;

      if (cached && cached.length > 0) {
        console.log(`[CartWhisper] Using cached data (${cached.length} items), trimming to ${maxRecommendations}`);
        recommendations = cached.slice(0, maxRecommendations);
        loadedFromCache = true;
      } else {
        console.log(`[CartWhisper] No cache, using API data (${apiRecommendations.length} items), trimming to ${maxRecommendations}`);
        recommendations = apiRecommendations.slice(0, maxRecommendations);

        // ‰øùÂ≠òÂÆåÊï¥ÁöÑÊé®ËçêÂàóË°®Âà∞ÁºìÂ≠òÔºà‰∏çÈôêÂà∂Êï∞ÈáèÔºâ
        if (apiRecommendations.length > 0) {
          cacheRecommendations(productId, apiRecommendations);
        }
      }

      console.log(`[CartWhisper] Final recommendations count: ${recommendations.length}`);
      return recommendations;

    } catch (error) {
      console.error('[CartWhisper] Failed to fetch recommendations', error);
      return [];
    }
  }

  // ËøΩË∏™Â±ïÁ§∫ÔºàÂΩìÊé®ËçêÊòæÁ§∫Êó∂Ôºâ
  function trackImpression(sourceProductId, recommendations) {
    if (!recommendations || recommendations.length === 0) return;

    // ‰ºòÂÖà‰ΩøÁî® numericIdÔºåÁ°Æ‰øùÊòØÁ∫ØÊï∞Â≠ó ID
    const targetProductIds = recommendations.map(r => {
      if (r.numericId) return String(r.numericId);
      if (r.id) return String(r.id).replace('gid://shopify/Product/', '');
      return null;
    }).filter(Boolean);

    if (targetProductIds.length === 0) return;

    const payload = {
      shop: shop,
      sourceProductId: String(sourceProductId),
      targetProductIds: targetProductIds
    };
    console.log('[CartWhisper] Tracking impression:', payload);

    fetch(`${backendUrl}/api/tracking/impression`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    })
    .then(r => r.json())
    .then(data => console.log('[CartWhisper] Impression result:', data))
    .catch(e => console.log('[CartWhisper] Impression tracking failed:', e.message));
  }

  // ËøΩË∏™ÁÇπÂáªÔºàÂΩìÁî®Êà∑ÁÇπÂáª Add to CartÔºâ
  function trackClick(sourceProductId, targetProductId) {
    // Ê∏ÖÁêÜ IDÔºåÁ°Æ‰øùÊòØÁ∫ØÊï∞Â≠óÊ†ºÂºè
    const cleanSourceId = String(sourceProductId).replace('gid://shopify/Product/', '');
    const cleanTargetId = String(targetProductId).replace('gid://shopify/Product/', '');

    const payload = {
      shop: shop,
      sourceProductId: cleanSourceId,
      targetProductId: cleanTargetId
    };
    console.log('[CartWhisper] Tracking click:', payload);

    fetch(`${backendUrl}/api/tracking/click`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    })
    .then(r => r.json())
    .then(data => console.log('[CartWhisper] Click result:', data))
    .catch(e => console.log('[CartWhisper] Click tracking failed:', e.message));
  }

  // Ê∑ªÂä†ÂïÜÂìÅÂà∞Ë¥≠Áâ©ËΩ¶
  async function addToCart(variantId, button) {
    button.disabled = true;
    button.textContent = '{{ block.settings.adding_text }}';

    try {
      const response = await fetch('/cart/add.js', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          items: [{ id: variantId, quantity: 1 }]
        })
      });

      if (response.ok) {
        button.textContent = '{{ block.settings.added_text }}';
        // Ëß¶ÂèëË¥≠Áâ©ËΩ¶Êõ¥Êñ∞‰∫ã‰ª∂
        document.dispatchEvent(new CustomEvent('cart:refresh'));
        // 2ÁßíÂêéÊÅ¢Â§çÊåâÈíÆ
        setTimeout(() => {
          button.disabled = false;
          button.textContent = '{{ block.settings.button_text }}';
        }, 2000);
      } else {
        throw new Error('Failed to add to cart');
      }
    } catch (error) {
      console.error('CartWhisper: Failed to add to cart', error);
      button.disabled = false;
      button.textContent = '{{ block.settings.button_text }}';
    }
  }

  // Ê∏≤ÊüìÊé®ËçêÂïÜÂìÅ
  function renderRecommendations(recommendations) {
    if (!recommendations || recommendations.length === 0) {
      container.style.display = 'none';
      return;
    }

    const currency = window.Shopify?.currency?.active || 'USD';
    const moneyFormat = window.Shopify?.moneyFormat || '${{amount}}';

    productsList.innerHTML = recommendations.map(rec => {
      const price = formatMoney(rec.price);
      const imageUrl = rec.image || 'https://via.placeholder.com/300x300?text=No+Image';
      // Áî® numericId ËøõË°åËøΩË∏™ÔºàÁ∫ØÊï∞Â≠ó IDÔºâ
      const trackingId = rec.numericId || (rec.id ? rec.id.replace('gid://shopify/Product/', '') : '');
      // Áî® handle ÊûÑÂª∫‰∫ßÂìÅÈìæÊé•
      const productUrl = rec.handle ? `/products/${rec.handle}` : `/products/${trackingId}`;

      return `
        <div class="cart-whisper-product">
          <a href="${productUrl}">
            <img class="cart-whisper-product-image" src="${imageUrl}" alt="${escapeHtml(rec.title)}" loading="lazy">
          </a>
          <div class="cart-whisper-product-info">
            <a href="${productUrl}" style="text-decoration:none;color:inherit;">
              <h4 class="cart-whisper-product-title">${escapeHtml(rec.title)}</h4>
            </a>
            ${rec.reasoning ? `<p class="cart-whisper-product-reasoning">${escapeHtml(rec.reasoning)}</p>` : ''}
            <div class="cart-whisper-product-footer">
              <span class="cart-whisper-product-price">${price}</span>
              <button class="cart-whisper-add-btn" data-product-id="${trackingId}" data-handle="${rec.handle || ''}" onclick="cartWhisperAddToCart(this, '${trackingId}', '${rec.handle || ''}')">
                {{ block.settings.button_text }}
              </button>
            </div>
          </div>
        </div>
      `;
    }).join('');

    loadingEl.style.display = 'none';
    container.style.display = 'block';

    // Ëá™Âä®ËøΩË∏™Â±ïÁ§∫Ôºà‰ªÖÈùûÁºìÂ≠òÊï∞ÊçÆÊâçËøΩË∏™ÔºåÈÅøÂÖçÈáçÂ§çËÆ°Êï∞Ôºâ
    if (currentSourceProductId && !loadedFromCache) {
      trackImpression(currentSourceProductId, recommendations);
    }
  }

  // Ê†ºÂºèÂåñ‰ª∑Ê†º
  function formatMoney(price) {
    const amount = parseFloat(price).toFixed(2);
    return `$${amount}`;
  }

  // HTMLËΩ¨‰πâ
  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text || '';
    return div.innerHTML;
  }

  // ÂÖ®Â±ÄÊ∑ªÂä†Ë¥≠Áâ©ËΩ¶ÂáΩÊï∞
  window.cartWhisperAddToCart = async function(button, productId, handle) {
    console.log('[CartWhisper] Add to cart clicked:', { productId, handle, sourceProductId: currentSourceProductId });

    // ËøΩË∏™ÁÇπÂáªÔºà‰ΩøÁî®Êï∞Â≠ó IDÔºâ
    if (currentSourceProductId) {
      trackClick(currentSourceProductId, productId);
    }

    // ‰ΩøÁî® handle Ëé∑ÂèñÂïÜÂìÅÁöÑÁ¨¨‰∏Ä‰∏™ variant
    const productPath = handle || productId;
    try {
      const response = await fetch(`/products/${productPath}.js`);
      if (!response.ok) {
        throw new Error(`Product not found: ${response.status}`);
      }
      const product = await response.json();
      const variantId = product.variants[0]?.id;
      console.log('[CartWhisper] Got variant:', variantId);
      if (variantId) {
        await addToCart(variantId, button);
      }
    } catch (error) {
      console.error('[CartWhisper] Failed to get product variant:', error);
      button.textContent = 'Error';
      setTimeout(() => {
        button.textContent = '{{ block.settings.button_text }}';
      }, 2000);
    }
  };

  // ‰∏ªÂáΩÊï∞
  async function init() {
    const cartItems = await getCartItems();
    if (cartItems.length === 0) {
      container.style.display = 'none';
      return;
    }

    // Ëé∑ÂèñË¥≠Áâ©ËΩ¶‰∏≠Á¨¨‰∏Ä‰∏™ÂïÜÂìÅÁöÑÊé®Ëçê
    const firstItem = cartItems[0];
    const productId = firstItem.product_id;

    const recommendations = await fetchRecommendations(productId);
    renderRecommendations(recommendations);
  }

  // È°µÈù¢Âä†ËΩΩÂêéÊâßË°å
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

  // ÁõëÂê¨Ë¥≠Áâ©ËΩ¶Êõ¥Êñ∞
  document.addEventListener('cart:refresh', init);
})();
</script>

{% schema %}
{
  "name": "Cart Recommendations",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "You might also like"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Based on what's in your cart"
    },
    {
      "type": "header",
      "content": "Button Settings"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Add to Cart"
    },
    {
      "type": "text",
      "id": "adding_text",
      "label": "Adding text",
      "default": "Adding..."
    },
    {
      "type": "text",
      "id": "added_text",
      "label": "Added text",
      "default": "Added!"
    },
    {
      "type": "text",
      "id": "loading_text",
      "label": "Loading text",
      "default": "Loading recommendations..."
    },
    {
      "type": "header",
      "content": "Style Settings"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#f9f9f9"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Subtitle color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "price_color",
      "label": "Price color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "title_size",
      "label": "Title size (px)",
      "min": 14,
      "max": 32,
      "step": 1,
      "default": 20
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Border radius (px)",
      "min": 0,
      "max": 24,
      "step": 2,
      "default": 8
    },
    {
      "type": "checkbox",
      "id": "show_border",
      "label": "Show border",
      "default": false
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border color",
      "default": "#e0e0e0"
    },
    {
      "type": "select",
      "id": "text_align",
      "label": "Text alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left"
    },
    {
      "type": "range",
      "id": "card_min_width",
      "label": "Card minimum width (px)",
      "min": 150,
      "max": 300,
      "step": 10,
      "default": 200
    },
    {
      "type": "range",
      "id": "margin_top",
      "label": "Margin top (px)",
      "min": 0,
      "max": 60,
      "step": 4,
      "default": 24
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "label": "Margin bottom (px)",
      "min": 0,
      "max": 60,
      "step": 4,
      "default": 24
    }
  ]
}
{% endschema %}
