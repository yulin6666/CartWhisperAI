# CartWhisperAI 回归测试用例表格

**版本**: 1.0
**创建日期**: 2026-02-05
**测试范围**: 前端 + 后端 + Shopify 扩展

---

## 测试优先级说明
- **P0**: 核心功能，必须通过
- **P1**: 重要功能，应该通过
- **P2**: 次要功能
- **P3**: 边缘场景

---

## 一、应用安装与注册

| 编号 | 测试项 | 优先级 | 测试步骤/预期结果 | 实际结果 | 状态 | 执行人 | 执行日期 | 备注 |
|------|--------|--------|------------------|----------|------|--------|----------|------|
| TC-001 | 首次安装应用 | P0 | 1. 在 Shopify 商店安装应用<br>2. 授权成功，跳转到应用主页<br>3. 显示 "Initial Setup" 提示<br>4. 后端自动注册商店并生成 API Key | | ⬜未测试 | | | |
| TC-002 | 重复安装应用 | P1 | 1. 卸载应用<br>2. 重新安装应用<br>3. 数据正确重置 | | ⬜未测试 | | | |

---

## 二、产品同步

| 编号 | 测试项 | 优先级 | 测试步骤/预期结果 | 实际结果 | 状态 | 执行人 | 执行日期 | 备注 |
|------|--------|--------|------------------|----------|------|--------|----------|------|
| TC-003 | 首次同步-FREE计划 | P0 | 1. 点击 "Start Initial Sync"<br>2. 只同步前 50 个产品<br>3. 显示产品数量超限警告<br>4. 同步完成后显示推荐数据<br>5. Token 使用量正确记录 | | ⬜未测试 | | | |
| TC-004 | 首次同步-PRO计划 | P0 | 1. 同步前 2000 个产品<br>2. 每个产品生成 3 个推荐<br>3. 同步状态正确更新 | | ⬜未测试 | | | |
| TC-005 | 首次同步-MAX计划 | P0 | 1. 同步所有产品（无限制）<br>2. 每个产品生成 6 个推荐 | | ⬜未测试 | | | |
| TC-006 | 手动刷新-FREE | P1 | 1. FREE: 每月只能刷新 1 次<br>2. 超限时显示错误提示<br>3. 刷新计数正确更新 | | ⬜未测试 | | | |
| TC-007 | 手动刷新-PRO | P1 | 1. PRO: 每月刷新 3 次<br>2. 超限时显示错误提示 | | ⬜未测试 | | | |
| TC-008 | 手动刷新-MAX | P1 | 1. MAX: 每月刷新 10 次<br>2. 超限时显示错误提示 | | ⬜未测试 | | | |
| TC-009 | 同步失败处理 | P1 | 1. 后端 API 超时（30分钟）<br>2. 显示错误信息<br>3. 可以重试同步 | | ⬜未测试 | | | |

---

## 三、订阅管理

| 编号 | 测试项 | 优先级 | 测试步骤/预期结果 | 实际结果 | 状态 | 执行人 | 执行日期 | 备注 |
|------|--------|--------|------------------|----------|------|--------|----------|------|
| TC-010 | 查看订阅计划 | P0 | 1. 显示当前计划（FREE/PRO/MAX）<br>2. 显示计划特性对比表<br>3. 显示使用量统计 | | ⬜未测试 | | | |
| TC-011 | 升级订阅-FREE→PRO | P0 | 1. 创建 $19.99 订阅<br>2. 跳转到 Shopify 支付页面<br>3. 支付成功后回调更新订阅状态 | | ⬜未测试 | | | |
| TC-012 | 升级订阅-FREE→MAX | P0 | 1. 创建 $49.99 订阅<br>2. 跳转到 Shopify 支付页面<br>3. 支付成功后回调更新订阅状态 | | ⬜未测试 | | | |
| TC-013 | 升级订阅-PRO→MAX | P0 | 1. 升级订阅成功<br>2. 订阅状态正确更新 | | ⬜未测试 | | | |
| TC-014 | 降级订阅-MAX→PRO | P1 | 1. 降级成功<br>2. 产品数量超限时显示警告 | | ⬜未测试 | | | |
| TC-015 | 降级订阅-PRO→FREE | P1 | 1. 取消订阅<br>2. 产品数量超限时显示警告 | | ⬜未测试 | | | |
| TC-016 | 取消订阅 | P1 | 1. 点击 "Cancel Subscription"<br>2. 确认取消<br>3. 订阅状态更新为 cancelled<br>4. 降级到 FREE 计划 | | ⬜未测试 | | | |
| TC-017 | 订阅状态同步 | P0 | 1. Shopify webhook 触发订阅更新<br>2. 后端正确处理 active/cancelled/expired 状态<br>3. 前端显示最新状态 | | ⬜未测试 | | | |

---

## 四、推荐展示

| 编号 | 测试项 | 优先级 | 测试步骤/预期结果 | 实际结果 | 状态 | 执行人 | 执行日期 | 备注 |
|------|--------|--------|------------------|----------|------|--------|----------|------|
| TC-018 | 管理后台推荐列表 | P0 | 1. 显示所有产品及其推荐<br>2. 推荐数量符合订阅计划（1/3/6个）<br>3. 显示推荐理由<br>4. 显示点击率统计 | | ⬜未测试 | | | |
| TC-019 | 店铺前端弹窗显示 | P0 | 1. 顾客添加商品到购物车<br>2. 自动弹出推荐窗口<br>3. 显示正确数量的推荐（根据计划）<br>4. 推荐商品图片、标题、价格正确显示 | | ⬜未测试 | | | |
| TC-020 | 弹窗添加商品 | P0 | 1. 点击推荐商品的 "Add to Cart"<br>2. 成功添加商品到购物车 | | ⬜未测试 | | | |
| TC-021 | 推荐缓存机制 | P1 | 1. 首次请求调用后端 API<br>2. 后续请求使用 localStorage 缓存（1小时）<br>3. 缓存过期后重新请求<br>4. API 失败时使用缓存降级 | | ⬜未测试 | | | |
| TC-022 | 水印显示-FREE | P2 | 1. FREE 用户显示 "Powered by CartWhisper AI" | | ⬜未测试 | | | |
| TC-023 | 水印显示-PRO/MAX | P2 | 1. PRO/MAX 用户无水印 | | ⬜未测试 | | | |

---

## 五、数据追踪

| 编号 | 测试项 | 优先级 | 测试步骤/预期结果 | 实际结果 | 状态 | 执行人 | 执行日期 | 备注 |
|------|--------|--------|------------------|----------|------|--------|----------|------|
| TC-024 | 展示追踪 | P1 | 1. 弹窗显示时发送追踪请求<br>2. 记录源商品 ID 和推荐商品 ID<br>3. 后端正确记录展示次数 | | ⬜未测试 | | | |
| TC-025 | 点击追踪 | P1 | 1. 点击推荐商品时发送追踪请求<br>2. 后端正确记录点击次数<br>3. CTR 计算正确 | | ⬜未测试 | | | |
| TC-026 | 统计数据显示 | P1 | 1. 管理后台显示总展示量<br>2. 显示总点击量<br>3. 显示 CTR（点击率）<br>4. 数据实时更新 | | ⬜未测试 | | | |

---

## 六、API 接口

| 编号 | 测试项 | 优先级 | 测试步骤/预期结果 | 实际结果 | 状态 | 执行人 | 执行日期 | 备注 |
|------|--------|--------|------------------|----------|------|--------|----------|------|
| TC-027 | API Key 认证 | P0 | 1. API Key 认证成功<br>2. 无效 API Key 返回 401<br>3. 缺少 API Key 返回 401 | | ⬜未测试 | | | |
| TC-028 | 速率限制-同步 | P1 | 1. 同步接口: 10次/分钟<br>2. 超限返回 429 错误 | | ⬜未测试 | | | |
| TC-029 | 速率限制-查询 | P1 | 1. 查询接口: 300次/分钟<br>2. 超限返回 429 错误 | | ⬜未测试 | | | |
| TC-030 | API调用限制-FREE | P0 | 1. FREE: 1000次/天<br>2. 超限返回错误提示 | | ⬜未测试 | | | |
| TC-031 | API调用限制-PRO | P0 | 1. PRO: 5000次/天<br>2. 超限返回错误提示 | | ⬜未测试 | | | |
| TC-032 | API调用限制-MAX | P0 | 1. MAX: 10000次/天<br>2. 超限返回错误提示 | | ⬜未测试 | | | |
| TC-033 | Token配额管理 | P0 | 1. 每日重置 Token 使用量<br>2. 全局配额限制（100万/天）<br>3. 超限时停止同步 | | ⬜未测试 | | | |

---

## 七、错误处理

| 编号 | 测试项 | 优先级 | 测试步骤/预期结果 | 实际结果 | 状态 | 执行人 | 执行日期 | 备注 |
|------|--------|--------|------------------|----------|------|--------|----------|------|
| TC-034 | 后端服务异常 | P1 | 1. 后端 API 不可用<br>2. 显示友好错误提示<br>3. 使用缓存降级 | | ⬜未测试 | | | |
| TC-035 | DeepSeek AI异常 | P1 | 1. AI API 调用失败<br>2. 使用 Fallback 推荐算法<br>3. 记录错误日志 | | ⬜未测试 | | | |
| TC-036 | Shopify API异常 | P1 | 1. GraphQL 查询失败<br>2. 显示错误信息<br>3. 可以重试 | | ⬜未测试 | | | |

---

## 八、性能测试

| 编号 | 测试项 | 优先级 | 测试步骤/预期结果 | 实际结果 | 状态 | 执行人 | 执行日期 | 备注 |
|------|--------|--------|------------------|----------|------|--------|----------|------|
| TC-037 | 同步性能-100产品 | P2 | 1. 100 个产品同步时间 < 5 分钟<br>2. 不阻塞其他操作 | | ⬜未测试 | | | |
| TC-038 | 同步性能-1000产品 | P2 | 1. 1000 个产品同步时间 < 20 分钟<br>2. 不阻塞其他操作 | | ⬜未测试 | | | |
| TC-039 | 推荐查询性能 | P2 | 1. 单次查询响应时间 < 500ms<br>2. 缓存命中率 > 80% | | ⬜未测试 | | | |
| TC-040 | 弹窗加载性能 | P2 | 1. 弹窗显示延迟 < 300ms<br>2. 不影响购物车添加操作 | | ⬜未测试 | | | |

---

## 九、兼容性测试

| 编号 | 测试项 | 优先级 | 测试步骤/预期结果 | 实际结果 | 状态 | 执行人 | 执行日期 | 备注 |
|------|--------|--------|------------------|----------|------|--------|----------|------|
| TC-041 | Chrome浏览器 | P2 | 1. Chrome 最新版正常运行 | | ⬜未测试 | | | |
| TC-042 | Safari浏览器 | P2 | 1. Safari 最新版正常运行 | | ⬜未测试 | | | |
| TC-043 | Firefox浏览器 | P2 | 1. Firefox 最新版正常运行 | | ⬜未测试 | | | |
| TC-044 | 移动端浏览器 | P2 | 1. 移动端浏览器正常运行 | | ⬜未测试 | | | |
| TC-045 | Dawn主题 | P2 | 1. Dawn 主题兼容 | | ⬜未测试 | | | |
| TC-046 | Debut主题 | P2 | 1. Debut 主题兼容 | | ⬜未测试 | | | |
| TC-047 | 自定义主题 | P2 | 1. 自定义主题兼容 | | ⬜未测试 | | | |

---

## 十、安全测试

| 编号 | 测试项 | 优先级 | 测试步骤/预期结果 | 实际结果 | 状态 | 执行人 | 执行日期 | 备注 |
|------|--------|--------|------------------|----------|------|--------|----------|------|
| TC-048 | API Key加密存储 | P1 | 1. API Key 加密存储 | | ⬜未测试 | | | |
| TC-049 | HMAC验证 | P1 | 1. HMAC 验证 Webhook | | ⬜未测试 | | | |
| TC-050 | OAuth 2.0 | P1 | 1. OAuth 2.0 正确实现 | | ⬜未测试 | | | |
| TC-051 | HTTPS加密 | P1 | 1. HTTPS 加密传输 | | ⬜未测试 | | | |
| TC-052 | 敏感数据保护 | P1 | 1. 敏感数据不暴露在前端 | | ⬜未测试 | | | |
| TC-053 | SQL注入防护 | P1 | 1. SQL 注入防护 | | ⬜未测试 | | | |
| TC-054 | CORS配置 | P1 | 1. App Proxy 正确设置跨域头<br>2. 只允许 Shopify 域名访问 | | ⬜未测试 | | | |

---

## 测试统计

| 优先级 | 总数 | 通过 | 失败 | 未测试 | 通过率 |
|--------|------|------|------|--------|--------|
| P0 | 0 | 0 | 0 | 0 | 0% |
| P1 | 0 | 0 | 0 | 0 | 0% |
| P2 | 0 | 0 | 0 | 0 | 0% |
| P3 | 0 | 0 | 0 | 0 | 0% |
| **总计** | **54** | **0** | **0** | **54** | **0%** |

---

## 缺陷记录

| 缺陷ID | 优先级 | 模块 | 测试编号 | 缺陷描述 | 重现步骤 | 状态 | 指派给 | 修复日期 | 备注 |
|--------|--------|------|----------|----------|----------|------|--------|----------|------|
| BUG-001 | | | | | | 待修复 | | | |
| BUG-002 | | | | | | 待修复 | | | |
| BUG-003 | | | | | | 待修复 | | | |

---

## 🚨 上线审核检查清单

### Shopify App Store 审核要求

| 检查项 | 优先级 | 状态 | 负责人 | 完成日期 | 备注 |
|--------|--------|------|--------|----------|------|
| 隐私政策页面 URL | P0 | ⬜未完成 | | | |
| 服务条款页面 URL | P0 | ⬜未完成 | | | |
| GDPR - customers/data_request webhook | P0 | ⬜未完成 | | | |
| GDPR - customers/redact webhook | P0 | ⬜未完成 | | | |
| GDPR - shop/redact webhook | P0 | ⬜未完成 | | | |
| app/uninstalled webhook | P0 | ⬜未完成 | | | |
| 应用图标 1024x1024 | P0 | ⬜未完成 | | | |
| 应用截图（至少3张） | P0 | ⬜未完成 | | | |
| 应用详细描述 | P0 | ⬜未完成 | | | |
| 使用教程文档 | P0 | ⬜未完成 | | | |
| 定价说明 | P0 | ⬜未完成 | | | |
| 错误提示优化 | P1 | ⬜未完成 | | | |
| 加载状态动画 | P1 | ⬜未完成 | | | |
| 空状态处理 | P1 | ⬜未完成 | | | |
| 多语言支持（英文） | P1 | ⬜未完成 | | | |
| 帮助文档链接 | P1 | ⬜未完成 | | | |

### 生产环境配置

| 检查项 | 优先级 | 状态 | 负责人 | 完成日期 | 备注 |
|--------|--------|------|--------|----------|------|
| SHOPIFY_API_KEY 生产密钥 | P0 | ⬜未完成 | | | |
| SHOPIFY_API_SECRET 生产密钥 | P0 | ⬜未完成 | | | |
| CARTWHISPER_BACKEND_URL 生产地址 | P0 | ⬜未完成 | | | |
| DATABASE_URL 生产数据库 | P0 | ⬜未完成 | | | |
| DEEPSEEK_API_KEY 生产密钥 | P0 | ⬜未完成 | | | |
| Prisma 数据库迁移 | P0 | ⬜未完成 | | | |
| 数据库备份 | P0 | ⬜未完成 | | | |
| 错误日志监控（Sentry） | P1 | ⬜未完成 | | | |
| 性能监控（New Relic） | P1 | ⬜未完成 | | | |
| 服务器监控（Railway） | P1 | ⬜未完成 | | | |

### 代码优化

| 检查项 | 优先级 | 状态 | 负责人 | 完成日期 | 备注 |
|--------|--------|------|--------|----------|------|
| 删除 console.log | P0 | ⬜未完成 | | | |
| 删除测试数据 | P0 | ⬜未完成 | | | |
| 删除 /app/test 路由 | P0 | ⬜未完成 | | | |
| 检查所有 API 端点认证 | P0 | ⬜未完成 | | | |
| 添加请求参数验证 | P0 | ⬜未完成 | | | |
| 防止 XSS 攻击 | P0 | ⬜未完成 | | | |
| 防止 CSRF 攻击 | P0 | ⬜未完成 | | | |
| 启用 CDN 缓存 | P1 | ⬜未完成 | | | |
| 压缩静态资源 | P1 | ⬜未完成 | | | |
| 优化数据库查询 | P1 | ⬜未完成 | | | |

### 法律合规文档

| 检查项 | 优先级 | 状态 | 负责人 | 完成日期 | 备注 |
|--------|--------|------|--------|----------|------|
| 隐私政策 - 数据收集说明 | P0 | ⬜未完成 | | | |
| 隐私政策 - 数据使用说明 | P0 | ⬜未完成 | | | |
| 隐私政策 - 数据存储位置 | P0 | ⬜未完成 | | | |
| 隐私政策 - 用户权利说明 | P0 | ⬜未完成 | | | |
| 隐私政策 - 联系方式 | P0 | ⬜未完成 | | | |
| 服务条款 - 服务范围 | P0 | ⬜未完成 | | | |
| 服务条款 - 付费说明 | P0 | ⬜未完成 | | | |
| 服务条款 - 退款政策 | P0 | ⬜未完成 | | | |
| 服务条款 - 责任限制 | P0 | ⬜未完成 | | | |
| 服务条款 - 终止条款 | P0 | ⬜未完成 | | | |

---

## 测试环境 vs 生产环境对比

| 项目 | 测试环境 | 生产环境 | 已切换 |
|-----|---------|---------|--------|
| Shopify API | 开发商店 | 真实商店 | ⬜ |
| 后端地址 | localhost:3000 | Railway 生产地址 | ⬜ |
| 数据库 | SQLite | PostgreSQL | ⬜ |
| AI API | 测试密钥 | 生产密钥 | ⬜ |
| 支付 | 测试模式 | 真实支付 | ⬜ |

---

## 测试签字确认

| 角色 | 姓名 | 签字 | 日期 |
|------|------|------|------|
| 测试负责人 | | | |
| 开发负责人 | | | |
| 产品负责人 | | | |
| 上线审批人 | | | |
